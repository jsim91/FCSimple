% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fcs_plot_trex.R
\name{fcs_plot_trex}
\alias{fcs_plot_trex}
\title{Tracking Responders EXpanding (T-REX) Hotspot Identification}
\usage{
fcs_plot_trex(
  fcs_join_obj,
  compare_list,
  reduction = c("UMAP", "tSNE"),
  outdir,
  point_alpha = 0.05,
  neighborhood_size = 60,
  percentile_breaks = c(0, 5, 10, 15, 85, 90, 95, 100),
  neighbor_significance_threshold = 0.9,
  cluster_min_size = 50,
  relative_cluster_distance = 30,
  file_output_prefix = NULL,
  use_MEM = TRUE,
  max_alloc = 2e+05,
  plot_intensities = FALSE
)
}
\arguments{
\item{fcs_join_obj}{A list returned by \code{FCSimple::fcs_join()} and
\code{FCSimple::fcs_reduce_dimensions()}, containing at minimum:
\itemize{
\item \verb{<reduction>$coordinates}: numeric Ncells×2 embedding matrix
\item \code{source}: character vector labeling each cell's sample of origin
\item \code{data}: expression matrix (events × channels)
}}

\item{compare_list}{A named list of exactly length 2. Each element is a character vector of
source names belonging to that group. List names become the group labels
in all outputs.}

\item{reduction}{Character; which 2D embedding to use. \code{"UMAP"} (default) or \code{"tSNE"}.}

\item{outdir}{Character; path to an existing directory where all output files are saved.}

\item{point_alpha}{Numeric; point transparency for embedding plots (default \code{0.05}).}

\item{neighborhood_size}{Integer; number of nearest neighbors per cell for the KNN search
(default \code{60}).}

\item{percentile_breaks}{Numeric vector of percentile boundaries (0–100) used to bin cells by
their local group fraction. Default \code{c(0,5,10,15,85,90,95,100)}.}

\item{neighbor_significance_threshold}{Fraction (0–1); cells with a local group-2 neighbor fraction above this
value or below \code{1 - threshold} are flagged as significant hotspots
(default \code{0.9}).}

\item{cluster_min_size}{Integer; minimum cell count for a DBSCAN hotspot cluster to be retained
(default \code{50}).}

\item{relative_cluster_distance}{Numeric divisor applied to the embedding range to derive the DBSCAN
epsilon radius (default \code{30}). Larger values → smaller epsilon → tighter
clusters.}

\item{file_output_prefix}{Character or \code{NULL}; optional string prepended to all output filenames
(default \code{NULL}).}

\item{use_MEM}{Logical; if \code{TRUE} (default), run Marker Enrichment Modeling via
\code{cytoMEM::MEM()} and save MEM heatmaps to \code{outdir}.}

\item{max_alloc}{Integer; maximum cells per hotspot group passed to DBSCAN. Excess cells
are randomly sub-sampled (default \code{200000}).}

\item{plot_intensities}{Logical; if \code{TRUE}, generates per-channel intensity embedding plots
(default \code{FALSE}).}
}
\value{
Invisibly returns \code{NULL}. All outputs (PDFs, CSVs) are written to
\code{outdir}. Returns \code{0} with a message if no significant hotspot regions
are found or all regions fall below \code{cluster_min_size}.
}
\description{
Applies the Tracking Responders EXpanding (T-REX) algorithm to identify
phenotypic “hotspots” of significant expansion or contraction between
two paired cytometry samples. Cells are embedded in 2D (UMAP or tSNE), a
k-nearest‐neighbor (KNN) search is performed around every cell, and local
neighborhoods with a specified percent-change threshold are flagged as
hotspots.
}
\details{
This implementation follows the original T-REX workflow of Barone et al. (2021), with the addition
of Marker Enrichment Modeling (MEM) for hotspot phenotyping per Diggins et al. (2017). Steps:
\enumerate{
\item Extract 2D embedding and split cells into reference vs. comparison groups.
\item For each cell, query its k nearest neighbors (k = \code{k}) via \code{RANN::nn2()}.
\item Compute local fraction of neighbors in each group; flag cells below
\code{change_thresholds[1]} (contraction) or above \code{change_thresholds[2]}
(expansion).
\item Optionally down-sample if Ncells > 500k for speed.
\item Run MEM (via \code{MEM::MarkerEnrichment}) on \code{mem_features} to derive
enrichment scores for each hotspot region.
\item Save hotspot assignments, MEM score tables, and diagnostics to \code{outdir}.
}
}
\examples{
\dontrun{
files   <- list(ff1, ff2)
joined  <- FCSimple::fcs_join(files)
reduced <- FCSimple::fcs_reduce_dimensions(joined, method = "UMAP")

FCSimple::fcs_plot_trex(
  fcs_join_obj  = reduced,
  compare_list  = list(group1 = c("sample_A"), group2 = c("sample_B")),
  reduction     = "UMAP",
  outdir        = "/path/to/output"
)
}

}
\references{
\enumerate{
\item Barone SM, Paul AG, Muehling LM, et al. Unsupervised machine learning
reveals key immune cell subsets in COVID-19, rhinovirus infection, and cancer
therapy. eLife. 2021;10:e64653. doi:10.7554/eLife.64653
\item Diggins KE, Greenplate AR, Leelatian N, Wogsland CE, Irish JM.
Characterizing cell subsets using Marker Enrichment Modeling. Nat Methods.
2017;14(3):275–278. doi:10.1038/nmeth.4149
}
}
\seealso{
\code{\link[=fcs_plot_reduction]{fcs_plot_reduction()}}, \code{\link[=fcs_cluster_heatmap]{fcs_cluster_heatmap()}},
\code{\link[RANN:nn2]{RANN::nn2()}}, \code{\link[dbscan:dbscan]{dbscan::dbscan()}}, \code{\link[cytoMEM:MEM]{cytoMEM::MEM()}}
}
