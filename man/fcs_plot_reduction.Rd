% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fcs_plot_reduction.R
\name{fcs_plot_reduction}
\alias{fcs_plot_reduction}
\title{Plot Clustered Reduction Embedding}
\usage{
fcs_plot_reduction(
  fcs_join_obj,
  algorithm,
  reduction,
  point_alpha = 0.1,
  point_size = 1,
  outdir = getwd(),
  split_factor = NA,
  internal_call = FALSE,
  anno_indices = NULL,
  keep_indices = NA,
  figure_width = 10,
  figure_height = 10,
  plotting_device = "pdf",
  annotate_text_size = 5,
  title_size = 14,
  return_plot = TRUE,
  randomize_colors = FALSE,
  color_random_seed = 123,
  color_clusters = TRUE,
  force_title = FALSE,
  sample_equally = TRUE,
  cluster_substitute_names = NA,
  add_timestamp = TRUE
)
}
\arguments{
\item{fcs_join_obj}{A list containing reduction coordinates and clustering results, as
produced by FCSimple::fcs_reduce_dimensions() and  
FCSimple::fcs_cluster(). Must include:  
- `fcs_join_obj[[ tolower(reduction) ]][["coordinates"]]`: a numeric  
  matrix of cell × 2 embedding coordinates  
- `fcs_join_obj[[ tolower(algorithm) ]][["clusters"]]`: a vector of  
  cluster IDs for each cell}

\item{algorithm}{Character; clustering result to visualize (e.g. “leiden”, “flowsom”).}

\item{reduction}{Character; dimensionality‐reduction to plot. Either “UMAP” or “tSNE”.}

\item{point_alpha}{Numeric; point transparency (alpha) for scatter (default 0.1).}

\item{point_size}{Numeric; point size for scatter (default 1).}

\item{outdir}{Character; directory path to save the plot when `return_plot = FALSE`
(default: `getwd()`).}

\item{split_factor}{Optional vector or factor the same length as rows of the reduction
coordinates. If not `NA`, splits data by its levels and arranges panels  
using ggpubr::ggarrange() (default: `NA`).}

\item{internal_call}{Logical; if `TRUE`, uses internal logic to highlight and annotate a subset
of events (`keep_indices`) and clusters (`anno_indices`) rather than full scatter (default `FALSE`).}

\item{anno_indices}{Integer vector; cluster indices to annotate when `internal_call = TRUE`
(default `NULL`).}

\item{keep_indices}{Integer vector; cell indices to highlight (in red) when
`internal_call = TRUE` (default `NA`).}

\item{figure_width}{Numeric; width in inches for saving plot (default 10).}

\item{figure_height}{Numeric; height in inches for saving plot (default 10).}

\item{plotting_device}{Character; “pdf” or “png” to select output device when writing file
(default “pdf”).}

\item{annotate_text_size}{Numeric; font size for cluster labels (use `NA` to disable, default 5).}

\item{title_size}{Numeric; font size for plot title (default 14).}

\item{return_plot}{Logical; if `TRUE` (default), returns the ggplot2 object; if `FALSE`,
writes the plot to file and invisibly returns `NULL`.}

\item{randomize_colors}{Logical; if `TRUE`, shuffles cluster‐color assignment (default `FALSE`).}

\item{color_random_seed}{Integer; seed for random color assignment when `randomize_colors = TRUE`
(default 123).}

\item{color_clusters}{Logical; if `TRUE` (default), color points by cluster; if `FALSE`, all
points are drawn in a single color.}

\item{force_title}{Logical; if `TRUE`, forces display of the reduction name as a title even
in split panels (default `FALSE`).}

\item{sample_equally}{Logical; if `TRUE`, downsamples each split‐group to equal size before plotting (default `TRUE`).}

\item{cluster_substitute_names}{Character vector; optional replacement labels for clusters (length must
match number of clusters, default `NA`).}

\item{add_timestamp}{Logical; if `TRUE` (default), appends a timestamp (`_YYYY-MM-DD_HHMMSS`)
to filenames when saving.}
}
\value{
If `return_plot = TRUE`, a ggplot2 object (or ggarrange object) is returned.  
  If `return_plot = FALSE`, the plot is written to file and the function  
  invisibly returns `NULL`.
}
\description{
Visualizes cell clusters on a 2D reduction embedding (UMAP or tSNE) as a  
  scatter plot with optional cluster labels, split panels, and flexible  
  output options. Supports coloring by cluster, randomizing palettes, and  
  saving to file or returning the ggplot object.
}
\details{
The function:
  1. Extracts embedding coordinates and cluster IDs.  
  2. Builds a data.frame for ggplot, mapping clusters to colors via a  
     default HCL palette (or randomized if requested).  
  3. Computes median centroids for each cluster for annotation.  
  4. If `split_factor` is `NA`, draws a single scatter plot. Otherwise splits  
     cells by factor levels, optionally downsamples equally, and arranges  
     subplots with ggpubr::ggarrange().  
  5. If `internal_call = TRUE`, highlights cells in `keep_indices` and  
     annotates clusters in `anno_indices`.  
  6. When `return_plot = FALSE`, saves to `outdir` as  
     `<algorithm>_<reduction>_labeled[(_timestamp)].pdf` or `.png`.
}
\examples{
\dontrun{
  files   <- list.files("data/", "\\\\.fcs$", full.names = TRUE)
  joined  <- FCSimple::fcs_join(files)
  reduced <- FCSimple::fcs_reduce_dimensions(joined, method = "UMAP")
  clustered <- FCSimple::fcs_cluster(reduced, algorithm = "leiden")

  # Return the plot object
  p <- FCSimple::fcs_plot_reduction(clustered, "leiden", "UMAP")
  print(p)

  # Save without returning, as PNG, no timestamp
  FCSimple::fcs_plot_reduction(
    clustered, "leiden", "UMAP",
    return_plot      = FALSE,
    plotting_device  = "png",
    figure_width     = 8,
    figure_height    = 8,
    add_timestamp    = FALSE
  )

  # Split panels by sample
  p2 <- FCSimple::fcs_plot_reduction(
    clustered, "leiden", "UMAP",
    split_factor  = clustered$source,
    sample_equally = FALSE
  )
}

}
\seealso{
FCSimple::fcs_reduce_dimensions, FCSimple::fcs_cluster,
  ggplot2::ggplot, ggrastr::geom_point_rast, ggpubr::ggarrange
}
