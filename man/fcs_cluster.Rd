% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fcs_cluster.R
\name{fcs_cluster}
\alias{fcs_cluster}
\title{Cluster Flow Cytometry Data with Multiple Algorithms}
\usage{
fcs_cluster(
  fcs_join_obj,
  use_rep = "data",
  language = c("R", "Python"),
  algorithm = c("leiden", "flowsom", "louvain", "phenograph", "git"),
  leiden_louvain_resolution = 1,
  flowsom_nClus = 15,
  phenograph_k = 30,
  adjacency_knn = 30,
  git_k = 30,
  search_method = c("FNN", "RANN"),
  search_only = FALSE,
  num_cores = ceiling(parallel::detectCores()/2),
  output_as = "adjacency"
)
}
\arguments{
\item{fcs_join_obj}{A list returned by FCSimple::fcs_join(), containing at least elements
\code{data} (numeric matrix) and, if \code{use_rep = "pca"}, \code{pca$pca_data}. If you’ve
already run FCSimple::fcs_batch_correction(), this function will detect
and use \code{fcs_join_obj$batch_correction$data}.}

\item{use_rep}{Character; representation to cluster. \code{"data"} (default) uses raw expression
values, \code{"pca"} uses principal‐component coordinates.}

\item{language}{Character; runtime environment for “git” clustering. \code{"R"} (default) runs
algorithms via R packages, \code{"Python"} calls out to bundled Python scripts.}

\item{algorithm}{Character; clustering algorithm to apply. One of \code{"leiden"}, \code{"louvain"},
\code{"flowsom"}, \code{"phenograph"}, or \code{"git"}.}

\item{leiden_louvain_resolution}{Numeric; resolution parameter for Leiden and Louvain clustering (default 1).}

\item{flowsom_nClus}{Integer; number of metaclusters for FlowSOM (default 15).}

\item{phenograph_k}{Integer; number of nearest neighbors for PhenoGraph (default 30).}

\item{adjacency_knn}{Integer; k for nearest‐neighbor graph in Leiden/Louvain (default 30).}

\item{git_k}{Integer; cluster count for Python “git” method (default 30).}

\item{search_method}{Character; neighbor‐search backend: \code{"FNN"} (default) or \code{"RANN"}.}

\item{search_only}{Logical; if \code{TRUE}, stops after neighbor search and returns updated
\code{fcs_join_obj} with either \code{adjacency_matrix} or \code{search} element
(default \code{FALSE}).}

\item{num_cores}{Integer; number of CPU cores for parallel neighbor‐search (default
\code{ceiling(parallel::detectCores()/2)}).}

\item{output_as}{Character; format of neighbor‐search output: \code{"adjacency"} (default) or
\code{"search"}.}
}
\value{
The original \code{fcs_join_obj} augmented with:
\itemize{
\item For \code{"search_only"}: an \code{adjacency_matrix} or \code{search} element.
\item For clustering algorithms: an element named by \code{algorithm} containing
\code{clusters} (factor/integer vector) and \code{settings} (list).
\item Updated \code{object_history} with timestamped entry.
}
}
\description{
Applies clustering to a joined flow cytometry object using one of several
algorithms: Leiden, Louvain, FlowSOM, PhenoGraph, or a Python‐based “git”
method. Can operate on raw expression data or PCA coordinates. Automatically
uses batch‐corrected data if available.
}
\details{
\itemize{
\item If batch correction is found, clustering runs on \code{fcs_join_obj$batch_correction$data}.
\item “git” writes a CSV/MTX, invokes a Python script, then reads back cluster IDs.
\item Leiden/Louvain builds a sparse k‐NN graph and calls igraph::cluster_*().
\item FlowSOM transforms data into a flowFrame and calls FlowSOM::FlowSOM().
\item PhenoGraph invokes Rphenograph::Rphenograph() and extracts membership.
\item After clustering, labels and algorithm settings are stored under
\code{fcs_join_obj[[algorithm]]}, and \code{object_history} is appended.
}
}
\examples{
\dontrun{
  ff_list <- list(flowFrame1, flowFrame2)
  joined <- FCSimple::fcs_join(ff_list)

  # Leiden clustering on raw data
  out1 <- FCSimple::fcs_cluster(
    joined,
    use_rep = "data",
    algorithm = "leiden",
    adjacency_knn = 50,
    leiden_louvain_resolution = 0.5
  )

  # FlowSOM clustering on PCA coordinates
  pca_obj <- FCSimple::fcs_pca(joined)
  out2 <- FCSimple::fcs_cluster(
    pca_obj,
    use_rep = "pca",
    algorithm = "flowsom",
    flowsom_nClus = 20
  )
}

}
\seealso{
FCSimple::fcs_join, FCSimple::fcs_batch_correction, FCSimple::fcs_pca
}
