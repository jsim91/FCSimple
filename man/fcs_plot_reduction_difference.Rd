% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fcs_density_difference.R
\name{fcs_plot_reduction_difference}
\alias{fcs_plot_reduction_difference}
\title{Plot Difference in Cell Density on a 2D Reduction Embedding}
\usage{
fcs_plot_reduction_difference(
  fcs_join_obj,
  reduction = c("UMAP", "tSNE"),
  compare_list,
  color_list,
  n_kde = 200,
  outdir = getwd(),
  axis_title_text_size = 12,
  dbscan_eps = "auto",
  dbscan_minPts = "auto",
  legend_label_text_size = 12,
  annotate_clusters = TRUE,
  cluster_algorithm = c("leiden", "flowsom", "louvain", "phenograph", "git"),
  cluster_number_annotation_size = 5,
  contour_bin_width = 0.001,
  legend_orientation = c("horizontal", "vertical"),
  figure_width = 8,
  figure_height = 8,
  hull_radius = 1.5,
  add_timestamp = TRUE,
  hull_concavity = 2
)
}
\arguments{
\item{fcs_join_obj}{A list returned by FCSimple::fcs_join() and
FCSimple::fcs_reduce_dimensions(), containing:
\itemize{
\item a named element “umap” or “tsne” with component “coordinates” (cell × 2 matrix)
\item clustering results under one of “leiden”, “louvain”, “flowsom”,
“phenograph”, or “git”
\item a “source” vector of sample identifiers matching rows of “coordinates”
}}

\item{reduction}{Character; which embedding to use. Either “UMAP” (default) or “tSNE”.}

\item{compare_list}{Named list of length 2, each element a character vector of sample IDs
to compare. Names must be unique and identical between \code{compare_list} and \code{color_list}.}

\item{color_list}{Named list of length 2, each element a single color (e.g. “red”). Names must
match those in \code{compare_list} and determine the low/high fill endpoints.}

\item{n_kde}{Integer; number of grid points per axis for \code{MASS::kde2d()} (default 200).}

\item{outdir}{Character; directory path where PDFs will be saved (default \code{getwd()}).}

\item{axis_title_text_size}{Numeric; font size for axis titles (default 12).}

\item{dbscan_eps}{Numeric or “auto”; epsilon parameter for \code{dbscan::dbscan()} on background
points. If “auto”, set to mean axis‐ranges/20 (default “auto”).}

\item{dbscan_minPts}{Numeric or “auto”; minPts for \code{dbscan::dbscan()}. If “auto”, set to
floor(nrow(background)/100) (default “auto”).}

\item{legend_label_text_size}{Numeric; font size for legend labels (default 12).}

\item{annotate_clusters}{Logical; if \code{TRUE} (default), cluster IDs are annotated at each cluster’s
median coordinate.}

\item{cluster_algorithm}{Character; which clustering result to annotate. One of
“leiden”, “louvain”, “flowsom”, “phenograph”, or “git” (default first).}

\item{cluster_number_annotation_size}{Numeric; font size for cluster‐ID annotations (default 5).}

\item{contour_bin_width}{Numeric; bin‐width for \code{stat_contour()} (default 0.001).}

\item{legend_orientation}{Character; “horizontal” or “vertical” (default “horizontal”) orientation
for the difference–fill legend.}

\item{figure_width}{Numeric; width (in inches) of individual PDF files (default 8).}

\item{figure_height}{Numeric; height (in inches) of individual PDF files (default 8).}

\item{hull_radius}{Numeric; radius (in mm) expansion around DBSCAN clusters for hull plotting
(default 1.5).}

\item{add_timestamp}{Logical; if \code{TRUE} (default), appends timestamp to PDF filenames.}

\item{hull_concavity}{Numeric; concavity parameter for hulls drawn by \code{ggforce::geom_mark_hull()}
(default 2).}
}
\value{
Invisibly returns \code{NULL} after saving the PDF files.
}
\description{
Computes and plots the difference between two sample‐group density estimates
on a 2D reduction (UMAP or tSNE). Generates filled‐contour difference maps,
underlying enrichment hulls, and a combined figure, then saves each as a PDF.
}
\details{
\enumerate{
\item Splits cells into two groups via \code{compare_list} and downsamples equally.
\item Computes 2D kernel density estimates (\code{MASS::kde2d}) on each group.
\item Calculates difference (\verb{group2 – group1}) and plots with \code{geom_tile()} +
\code{stat_contour()}.
\item Computes background islands via \code{dbscan::dbscan()} and draws enrichment
hulls with \code{geom_mark_hull()}.
\item Arranges difference plot, hull plot, and shared legend side‐by‐side.
\item Saves four PDFs to \code{outdir}:
\itemize{
\item \verb{<grp1>_vs_<grp2>_<reduction>_density_difference_under.pdf}
\item \verb{<grp1>_vs_<grp2>_<reduction>_density_difference_over.pdf}
\item \verb{<grp1>_vs_<grp2>_<reduction>_density_difference_legend.pdf}
\item \verb{<grp1>_vs_<grp2>_<reduction>_density_difference_combined.pdf}
}
}
}
\examples{
\dontrun{
  # Compute reduction first
  obj <- FCSimple::fcs_reduce_dimensions(joined, method = "UMAP")

  # Define groups and colors
  compare <- list(Healthy = c("S1","S2"), Diseased = c("S3","S4"))
  colors  <- list(Healthy = "blue", Diseased = "red")

  # Plot and save density‐difference maps
  FCSimple::fcs_plot_reduction_difference(
    obj,
    reduction = "UMAP",
    compare_list = compare,
    color_list   = colors,
    n_kde        = 150,
    outdir       = "~/results",
    annotate_clusters = FALSE
  )
}

}
\seealso{
FCSimple::fcs_plot_reduction_density,
FCSimple::fcs_reduce_dimensions,
MASS::kde2d,
dbscan::dbscan,
ggforce::geom_mark_hull
}
