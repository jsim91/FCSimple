% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fcs_cluster_abundance.R
\name{fcs_calculate_abundance}
\alias{fcs_calculate_abundance}
\title{Calculate Cluster Abundance Across Samples}
\usage{
fcs_calculate_abundance(
  fcs_join_obj,
  report_algorithm = c("leiden", "flowsom", "louvain", "phenograph", "git"),
  report_as = c("frequency", "fraction", "count"),
  return_abundance = FALSE
)
}
\arguments{
\item{fcs_join_obj}{A list returned by FCSimple::fcs_join() and FCSimple::fcs_cluster(),
containing at minimum:
\itemize{
\item \code{source}: a character vector of original sample identifiers
\item \verb{<algorithm>}: a list whose first element is a vector of cluster IDs
\item \code{object_history}: an optional history log
}}

\item{report_algorithm}{Character; name of the clustering result to summarize. One of
\code{"leiden"}, \code{"flowsom"}, \code{"louvain"}, \code{"phenograph"}, or \code{"git"}.}

\item{report_as}{Character; type of abundance metric. One of
\code{"frequency"} (0–100), \code{"fraction"} (0–1), or \code{"count"} (raw cell counts).
Defaults to \code{"frequency"}.}

\item{return_abundance}{Logical; if \code{TRUE}, the function returns the abundance matrix directly
and does not modify \code{fcs_join_obj}. Defaults to \code{FALSE}.}
}
\value{
If \code{return_abundance = TRUE}, a numeric matrix (samples × clusters)
containing counts, frequencies, or fractions. Otherwise, the input
\code{fcs_join_obj}, augmented with:
\itemize{
\item \verb{<algorithm>$abundance}: a numeric matrix (samples × clusters)
\item updated \code{object_history}
}
}
\description{
Computes per‐sample cluster abundances for a previously clustered flow
cytometry object. Stores a matrix of raw cell counts, frequencies (0–100),
or fractions (0–1) under the chosen algorithm’s \code{abundance} element, and
appends a timestamped entry to \code{object_history}.
}
\details{
The function will:
\enumerate{
\item Validate that the specified algorithm and \code{source} exist.
\item If \code{report_as = "count"}, tabulate raw cell counts per cluster, per sample.
Otherwise, compute proportions of cells in each cluster per sample.
\item If \code{report_as = "frequency"}, multiply proportions by 100.
\item If \code{return_abundance = TRUE}, return the abundance matrix.
Otherwise, store it in
\code{fcs_join_obj[[report_algorithm]][["abundance"]]}.
\item If not returning directly, append a timestamped note to
\code{object_history}.
}
}
\examples{
\dontrun{
  joined <- FCSimple::fcs_join(list(ff1, ff2))
  clustered <- FCSimple::fcs_cluster(joined, algorithm = "leiden")

  # Get percentage abundance for Leiden clusters
  out1 <- FCSimple::fcs_calculate_abundance(
    clustered,
    report_algorithm = "leiden",
    report_as = "frequency"
  )

  # Get raw cell counts for Leiden clusters, return matrix directly
  counts_mat <- FCSimple::fcs_calculate_abundance(
    clustered,
    report_algorithm = "leiden",
    report_as = "count",
    return_abundance = TRUE
  )
}

}
\seealso{
FCSimple::fcs_cluster, FCSimple::fcs_report_abundance
}
