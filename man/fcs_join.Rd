% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fcs_join.R
\name{fcs_join}
\alias{fcs_join}
\title{Read and Join Multiple FCS or CSV Files into a Single Analysis Object}
\usage{
fcs_join(
  files,
  flowjo_diagnostics_file = NULL,
  apply_transform = TRUE,
  use_descriptive_column_names = TRUE,
  transform_function = NULL,
  transform_type = "asinh",
  asinh_transform_cofactor = 5,
  biexp_transform_pos = 4.5,
  biexp_transform_neg = 0,
  biexp_transform_width = -10,
  hyperlog_transform_T = 1e+05,
  hyperlog_transform_M = 5,
  hyperlog_transform_W = 0.001,
  hyperlog_transform_A = 2,
  transform_per_channel = FALSE,
  downsample_size = 25000,
  batch_pattern = "[0-9]+\\\\-[A-Za-z]+\\\\-[0-9]+"
)
}
\arguments{
\item{files}{Character vector of file paths to .fcs or .csv files. For CSV files, data
should be pre-transformed and exported from FlowJo with proper formatting
(see Details).}

\item{flowjo_diagnostics_file}{Optional path to a FlowJo diagnostics TXT file (Configure → Diagnostics →
“Show XML for Workspace”). Provides per-channel transform parameters.
Default \code{NULL}.}

\item{apply_transform}{Logical; if \code{TRUE} (default), applies channel transformations. If \code{FALSE},
returns raw data only.}

\item{use_descriptive_column_names}{Logical; if \code{TRUE} (default), replaces channel names with descriptive labels
from FCS metadata.}

\item{transform_function}{Optional user-supplied \code{transformList} (e.g., from
\code{flowCore::transformList}) for per-channel transforms. Overrides
\code{transform_type} when \code{transform_per_channel = TRUE}.}

\item{transform_type}{Character; global transform to apply when \code{transform_per_channel = FALSE}.
One of \code{"asinh"}, \code{"biexp"}, or \code{"hyperlog"}. Default \code{"asinh"}.}

\item{asinh_transform_cofactor}{Numeric cofactor for asinh transforms (default 5).}

\item{biexp_transform_pos}{Numeric positive breakpoint for biexp (default 4.5).}

\item{biexp_transform_neg}{Numeric negative breakpoint for biexp (default 0).}

\item{biexp_transform_width}{Numeric width basis for biexp (default -10).}

\item{hyperlog_transform_T}{Numeric “T” parameter for hyperlog transform (default 100000).}

\item{hyperlog_transform_M}{Numeric “M” decades for hyperlog transform (default 5).}

\item{hyperlog_transform_W}{Numeric “W” width around zero for hyperlog transform (default 0.001).}

\item{hyperlog_transform_A}{Numeric “A” offset for hyperlog transform (default 2).}

\item{transform_per_channel}{Logical; if \code{TRUE} (default), launches an interactive Shiny application
(in \verb{transform_app/}) to preview and tweak per-channel transforms. The
function will block until you finish and close the app. If \code{FALSE},
applies the global \code{transform_type}.}

\item{downsample_size}{Integer or \code{NA}; maximum events per file to sample before joining.
Default \code{NA} (no downsampling).}

\item{batch_pattern}{Regular expression to extract \code{run_date} from sample names in \code{source}.
Default \code{"[0-9]+\\\\-[A-Za-z]+\\\\-[0-9]+"}.}

\item{instrument_type}{Deprecated. Instrument type is now auto-detected: if min(data) >= 0, assumes
'cytof' (mass cytometry); otherwise assumes 'flow' (fluorescence cytometry).}
}
\value{
A list with elements:
\itemize{
\item \code{data}: numeric matrix of transformed events × channels (or data frame for CSV).
\item \code{raw}: numeric matrix of untransformed events × channels (or NA for CSV files).
\item \code{source}: character vector of sample identifiers for each event.
\item \code{run_date}: character vector parsed from \code{source} via \code{batch_pattern}.
\item \code{metadata}: data frame with columns \code{patient_ID} and \code{run_date} (one row per file).
\item \code{transform_list}: per-channel transform parameters (if FlowJo diagnostics file used).
\item \code{collection_instrument}: chosen \code{instrument_type}.
\item \code{object_history}: timestamped entry recording the join.
}
}
\description{
Reads a set of FCS or CSV files, optionally downsamples and applies transformations
(FlowJo diagnostics, asinh, biexp, or hyperlog), and concatenates them into
a unified data matrix with accompanying metadata and history.

For CSV files, the function assumes data is already transformed. CSV files should
be exported from FlowJo using 'CSV - Channel values' with 'Include header' and
'Stain' selected after all transforms have been applied. Ensure a run date ($DATE)
is included in the file names.
}
\details{
Internally, the function:
\enumerate{
\item For FCS files: Reads all files into a \code{flowSet} via \code{flowCore::read.flowSet()}.
For CSV files: Reads using \code{data.table::fread()} assuming pre-transformed data.
\item Optionally downsamples each file to \code{downsample_size}.
\item Extracts expression matrices with \code{flowCore::exprs()} (FCS) or directly from
data frames (CSV).
\item If \code{transform_per_channel = TRUE} (FCS only), launches the package's
\verb{transform_app/} Shiny GUI so you can inspect per-channel
diagnostics and build a custom \code{transformList}.
\item Otherwise, applies the global transform as specified by
\code{transform_type} or user's \code{transform_function} (FCS only).
\item Concatenates raw and transformed data into \code{raw} and \code{data} matrices.
\item Builds \code{source} and \code{run_date} via \code{flowCore::sampleNames()} or file names
and \code{stringr::str_extract()}.
\item Creates \code{metadata} data frame with patient_ID and run_date.
\item Records \code{collection_instrument} and appends a timestamp in
\code{object_history}.
}
}
\examples{
\dontrun{ (FCS files)
files <- list.files("data/fcs", pattern = "\\\\.fcs$", full.names = TRUE)
joined <- FCSimple::fcs_join(files)

# Interactive per-channel diagnostics via Shiny
joined2 <- FCSimple::fcs_join(
  files,
  transform_per_channel = TRUE
)

# Raw join without any transforms
joined_raw <- FCSimple::fcs_join(files, apply_transform = FALSE)

# Join pre-transformed CSV files exported from FlowJo
csv_files <- list.files("data/flowjo_export", pattern = "\\\\.csv$", full.names = TRUE)
joined_csv <- FCSimple::fcs_join(csv_files
joined_raw <- FCSimple::fcs_join(files, apply_transform = FALSE)
}

}
\seealso{
flowCore::read.flowSet, flowCore::exprs, flowCore::transformList,
flowWorkspace::flowjo_biexp, stringr::str_extract
}
