% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fcs_plot_reduction.R
\name{fcs_plot_reduction}
\alias{fcs_plot_reduction}
\title{Plot Clustered Reduction Embedding}
\usage{
fcs_plot_reduction(
  fcs_join_obj,
  algorithm,
  reduction,
  point_alpha = 0.1,
  point_size = 1,
  outdir = getwd(),
  split_factor = NA,
  internal_call = FALSE,
  anno_indices = NULL,
  keep_indices = NA,
  figure_width = 10,
  figure_height = 10,
  plotting_device = "pdf",
  annotate_text_size = 5,
  title_size = 14,
  return_plot = TRUE,
  randomize_colors = FALSE,
  color_random_seed = 123,
  color_clusters = TRUE,
  force_title = FALSE,
  sample_equally = TRUE,
  cluster_substitute_names = NA,
  add_timestamp = TRUE
)
}
\arguments{
\item{fcs_join_obj}{A list containing reduction coordinates and clustering results, as
produced by FCSimple::fcs_reduce_dimensions() and
FCSimple::fcs_cluster(). Must include:
\itemize{
\item \code{fcs_join_obj[[ tolower(reduction) ]][["coordinates"]]}: a numeric
matrix of cell × 2 embedding coordinates
\item \code{fcs_join_obj[[ tolower(algorithm) ]][["clusters"]]}: a vector of
cluster IDs for each cell
}}

\item{algorithm}{Character; clustering result to visualize (e.g. “leiden”, “flowsom”).}

\item{reduction}{Character; dimensionality‐reduction to plot. Either “UMAP” or “tSNE”.}

\item{point_alpha}{Numeric; point transparency (alpha) for scatter (default 0.1).}

\item{point_size}{Numeric; point size for scatter (default 1).}

\item{outdir}{Character; directory path to save the plot when \code{return_plot = FALSE}
(default: \code{getwd()}).}

\item{split_factor}{Optional vector or factor the same length as rows of the reduction
coordinates. If not \code{NA}, splits data by its levels and arranges panels
using ggpubr::ggarrange() (default: \code{NA}).}

\item{internal_call}{Logical; if \code{TRUE}, uses internal logic to highlight and annotate a subset
of events (\code{keep_indices}) and clusters (\code{anno_indices}) rather than full scatter (default \code{FALSE}).}

\item{anno_indices}{Integer vector; cluster indices to annotate when \code{internal_call = TRUE}
(default \code{NULL}).}

\item{keep_indices}{Integer vector; cell indices to highlight (in red) when
\code{internal_call = TRUE} (default \code{NA}).}

\item{figure_width}{Numeric; width in inches for saving plot (default 10).}

\item{figure_height}{Numeric; height in inches for saving plot (default 10).}

\item{plotting_device}{Character; “pdf” or “png” to select output device when writing file
(default “pdf”).}

\item{annotate_text_size}{Numeric; font size for cluster labels (use \code{NA} to disable, default 5).}

\item{title_size}{Numeric; font size for plot title (default 14).}

\item{return_plot}{Logical; if \code{TRUE} (default), returns the ggplot2 object; if \code{FALSE},
writes the plot to file and invisibly returns \code{NULL}.}

\item{randomize_colors}{Logical; if \code{TRUE}, shuffles cluster‐color assignment (default \code{FALSE}).}

\item{color_random_seed}{Integer; seed for random color assignment when \code{randomize_colors = TRUE}
(default 123).}

\item{color_clusters}{Logical; if \code{TRUE} (default), color points by cluster; if \code{FALSE}, all
points are drawn in a single color.}

\item{force_title}{Logical; if \code{TRUE}, forces display of the reduction name as a title even
in split panels (default \code{FALSE}).}

\item{sample_equally}{Logical; if \code{TRUE}, downsamples each split‐group to equal size before plotting (default \code{TRUE}).}

\item{cluster_substitute_names}{Character vector; optional replacement labels for clusters (length must
match number of clusters, default \code{NA}).}

\item{add_timestamp}{Logical; if \code{TRUE} (default), appends a timestamp (\verb{_YYYY-MM-DD_HHMMSS})
to filenames when saving.}
}
\value{
If \code{return_plot = TRUE}, a ggplot2 object (or ggarrange object) is returned.
If \code{return_plot = FALSE}, the plot is written to file and the function
invisibly returns \code{NULL}.
}
\description{
Visualizes cell clusters on a 2D reduction embedding (UMAP or tSNE) as a
scatter plot with optional cluster labels, split panels, and flexible
output options. Supports coloring by cluster, randomizing palettes, and
saving to file or returning the ggplot object.
}
\details{
The function:
\enumerate{
\item Extracts embedding coordinates and cluster IDs.
\item Builds a data.frame for ggplot, mapping clusters to colors via a
default HCL palette (or randomized if requested).
\item Computes median centroids for each cluster for annotation.
\item If \code{split_factor} is \code{NA}, draws a single scatter plot. Otherwise splits
cells by factor levels, optionally downsamples equally, and arranges
subplots with ggpubr::ggarrange().
\item If \code{internal_call = TRUE}, highlights cells in \code{keep_indices} and
annotates clusters in \code{anno_indices}.
\item When \code{return_plot = FALSE}, saves to \code{outdir} as
\verb{<algorithm>_<reduction>_labeled[(_timestamp)].pdf} or \code{.png}.
}
}
\examples{
\dontrun{
  files   <- list.files("data/", "\\\\.fcs$", full.names = TRUE)
  joined  <- FCSimple::fcs_join(files)
  reduced <- FCSimple::fcs_reduce_dimensions(joined, method = "UMAP")
  clustered <- FCSimple::fcs_cluster(reduced, algorithm = "leiden")

  # Return the plot object
  p <- FCSimple::fcs_plot_reduction(clustered, "leiden", "UMAP")
  print(p)

  # Save without returning, as PNG, no timestamp
  FCSimple::fcs_plot_reduction(
    clustered, "leiden", "UMAP",
    return_plot      = FALSE,
    plotting_device  = "png",
    figure_width     = 8,
    figure_height    = 8,
    add_timestamp    = FALSE
  )

  # Split panels by sample
  p2 <- FCSimple::fcs_plot_reduction(
    clustered, "leiden", "UMAP",
    split_factor  = clustered$source,
    sample_equally = FALSE
  )
}

}
\seealso{
FCSimple::fcs_reduce_dimensions, FCSimple::fcs_cluster,
ggplot2::ggplot, ggrastr::geom_point_rast, ggpubr::ggarrange
}
